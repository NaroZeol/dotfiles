# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# tmux settings
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

# Display color
set -g default-terminal "xterm-256color"

# escape delay
set -g escape-time 200

# mouse enable
set -g mouse on

# start window numbers at 1 to match keyboard order with tmux order
set -g base-index 1

# start pane numbers at 1 to match keyboard order with tmux order
setw -g pane-base-index 1

# renumber windows sequentially after closing any of them
set -g renumber-windows on

# increase scrollback lines
set -g history-limit 65536

# get links working
set -ga terminal-features "*:hyperlinks"

# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# key bindings
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

# bind Ctrl-A as prefix key
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# act like vim
setw -g mode-keys vi
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

bind -T copy-mode-vi "v" send -X begin-selection
bind -T copy-mode-vi "V" send -X rectangle-toggle
bind -T copy-mode-vi "y" send -X copy-selection-no-clear \; display "Copied!"

# reload config with prefix + r
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# bind - as vertical split window
bind - split-window -v
# bind | as horizontal split window
bind | split-window -h

# bind v as next-layout because plugin tmux-easy-motion takes the key <SPACE>
bind v next-layout

# let tmux's mouse drag like normal terminal
# Ref: https://github.com/tmux/tmux/issues/140#issuecomment-474341833
unbind-key -T copy-mode-vi MouseDragEnd1Pane
bind-key -T copy-mode-vi MouseDown1Pane select-pane\; send-keys -X clear-selection
# bind -n MouseDrag1Pane if -Ft= '#{mouse_any_flag}' 'if -Ft= \"#{pane_in_mode}\" \"copy-mode -eM\" \"send-keys -M\"' 'copy-mode -eM'

# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# appearance
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

# default colour for status bar and pane border on different hosts
%if   #{==:#{host},Amadeus}
    set -g @color_default colour166
%elif #{==:#{host},Salieri}
    set -g @color_default colour1
%elif #{==:#{host},FG204}
    set -g @color_default colour155
%elif #{==:#{host},FG205}
    set -g @color_default colour80
%else
    set -g @color_default colour166
%endif

# statusbar
set -g status-left-length 20
set -g status-right-length 200
set -g status-position bottom
set -g status-justify left
set -g status-interval 2
set -g status-left ''
set -g status-right '#[fg=colour233,bg=colour241,bold] #{pane_current_command} #[fg=colour233,bg=colour248,bold] #{host_short} #[fg=colour233,bg=colour241,bold] %m/%d #[fg=colour233,bg=colour248,bold] %H:%M#[fg=colour233,bg=colour248,bold]#{?client_prefix,+, }'
set -g -F status-style bg="#{@color_default}",fg=colour131,dim
set -g -F message-style bg="#{@color_default}",fg=colour16,bold

# pane-border
set -g pane-border-style fg=white,bg=default
set -g -F pane-active-border-style fg="#{@color_default}",bg=default

# window status
setw -g window-status-separator ""
setw -g window-status-current-style fg=colour172,bg=colour235,bold
setw -g window-status-current-format ' #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour226]#F '
setw -g window-status-style fg=colour138,bg=colour238,none
setw -g window-status-format ' #I#[fg=colour237]:#[fg=colour250]#W#[fg=colour244]#F '

# copy mode style
set -g mode-style "fg=black,bg=#{@color_default}"

setw -g window-status-bell-style 'fg=colour255 bg=colour1 bold'

# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
# plugin
# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

# List
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'IngoMeyer441/tmux-easy-motion'

# Config
set -g @easy-motion-target-keys "asdghklqwertyuiopzxcvbnmfj" # default easy-motion-target-keys without ';'

# Install tpm if it is not installed
# Uncomment this if dotfile is new installed
# Ref: https://github.com/tmux-plugins/tpm/blob/master/docs/automatic_tpm_installation.md
# if "test ! -d ~/.tmux/plugins/tpm" \
#    "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

if "test -d ~/.tmux/plugins/tpm" \
    "run ~/.tmux/plugins/tpm/tpm"
